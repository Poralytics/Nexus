<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Executive Dashboard â€” NEXUS</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: Inter, sans-serif; background: #0a1628; color: #f8fafc; padding: 2rem; }
.container { max-width: 1400px; margin: 0 auto; }
.header { margin-bottom: 3rem; }
.header h1 { font-size: 2.5rem; font-weight: 900; margin-bottom: 0.5rem; }
.header .subtitle { color: #cbd5e1; font-size: 1.1rem; }
.headline { background: linear-gradient(135deg, #1a2332, #243447); border-left: 4px solid #3b82f6; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; }
.headline h2 { font-size: 1.5rem; margin-bottom: 0.5rem; }
.headline.critical { border-color: #dc2626; }
.headline.warning { border-color: #f59e0b; }
.headline.success { border-color: #10b981; }
.grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
.metric-card { background: #1a2332; border: 2px solid rgba(148,163,184,0.15); border-radius: 16px; padding: 1.5rem; }
.metric-label { font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.5rem; }
.metric-value { font-size: 2.5rem; font-weight: 900; margin-bottom: 0.25rem; }
.metric-change { font-size: 0.85rem; color: #10b981; }
.metric-change.down { color: #dc2626; }
.section { background: #1a2332; border: 2px solid rgba(148,163,184,0.15); border-radius: 16px; padding: 2rem; margin-bottom: 2rem; }
.section h3 { font-size: 1.25rem; font-weight: 700; margin-bottom: 1.5rem; }
.recommendation { background: #243447; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; border-left: 4px solid #3b82f6; }
.recommendation.priority-1 { border-color: #dc2626; }
.recommendation.priority-2 { border-color: #f59e0b; }
.rec-title { font-weight: 700; margin-bottom: 0.5rem; font-size: 1.1rem; }
.rec-meta { display: flex; gap: 1rem; font-size: 0.85rem; color: #94a3b8; margin-bottom: 0.5rem; }
.rec-action { color: #cbd5e1; }
.financial-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1rem; }
.financial-item { background: #243447; padding: 1rem; border-radius: 8px; }
.financial-label { font-size: 0.85rem; color: #94a3b8; margin-bottom: 0.5rem; }
.financial-value { font-size: 1.5rem; font-weight: 700; }
.bullets { list-style: none; }
.bullets li { padding: 0.75rem 0; border-bottom: 1px solid rgba(148,163,184,0.1); }
.bullets li:last-child { border-bottom: none; }
.export-btn { background: linear-gradient(135deg, #1e40af, #6366f1); color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 1rem; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Executive Security Dashboard</h1>
    <div class="subtitle">Security posture overview for leadership</div>
  </div>

  <div class="headline" id="headline">
    <h2 id="headlineText">Loading...</h2>
  </div>

  <div class="grid">
    <div class="metric-card">
      <div class="metric-label">Security Score</div>
      <div class="metric-value" id="securityScore">---</div>
      <div class="metric-change" id="scoreChange">Loading...</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Industry Percentile</div>
      <div class="metric-value" id="percentile">--</div>
      <div class="metric-change">vs. industry average</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Breach Probability</div>
      <div class="metric-value" id="breachProb">--%</div>
      <div class="metric-change" id="breachChange">Current risk level</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Financial Risk</div>
      <div class="metric-value" id="financialRisk">$--</div>
      <div class="metric-change">Potential exposure</div>
    </div>
  </div>

  <div class="section">
    <h3>Key Findings</h3>
    <ul class="bullets" id="keyFindings">
      <li>Loading...</li>
    </ul>
  </div>

  <div class="section">
    <h3>Priority Recommendations</h3>
    <div id="recommendations">
      <div class="recommendation">Loading...</div>
    </div>
  </div>

  <div class="section">
    <h3>Financial Analysis</h3>
    <div class="financial-grid" id="financialGrid">
      <div class="financial-item">
        <div class="financial-label">Total Risk Exposure</div>
        <div class="financial-value" id="riskExposure">$--</div>
      </div>
      <div class="financial-item">
        <div class="financial-label">Investment Required</div>
        <div class="financial-value" id="investmentNeeded">$--</div>
      </div>
      <div class="financial-item">
        <div class="financial-label">Expected ROI</div>
        <div class="financial-value" id="expectedROI">--%</div>
      </div>
      <div class="financial-item">
        <div class="financial-label">Payback Period</div>
        <div class="financial-value" id="paybackPeriod">-- months</div>
      </div>
    </div>
  </div>

  <button class="export-btn" onclick="exportReport()">ðŸ“¥ Export Report (CSV)</button>
</div>

<script>
async function loadExecutiveDashboard() {
  try {
    const token = localStorage.getItem('token');
    if (!token) {
      window.location.href = '/login.html';
      return;
    }

    const res = await fetch('/api/executive/summary', {
      headers: { 'Authorization': `Bearer ${token}` }
    });

    if (!res.ok) throw new Error('Failed to load');

    const data = await res.json();

    // Headline
    const headline = document.getElementById('headline');
    document.getElementById('headlineText').textContent = data.executive_summary.headline;
    
    if (data.executive_summary.score >= 750) {
      headline.className = 'headline success';
    } else if (data.executive_summary.score >= 500) {
      headline.className = 'headline warning';
    } else {
      headline.className = 'headline critical';
    }

    // Metrics
    document.getElementById('securityScore').textContent = data.key_metrics.security_score + '/1000';
    document.getElementById('scoreChange').textContent = data.executive_summary.trend.improving 
      ? `â†‘ +${data.executive_summary.trend.difference} points`
      : `â†“ -${data.executive_summary.trend.difference} points`;
    document.getElementById('scoreChange').className = data.executive_summary.trend.improving 
      ? 'metric-change' : 'metric-change down';

    document.getElementById('percentile').textContent = data.key_metrics.industry_percentile + '%';
    document.getElementById('breachProb').textContent = data.key_metrics.breach_probability + '%';
    document.getElementById('financialRisk').textContent = '$' + formatNumber(data.key_metrics.financial_risk);

    // Key Findings
    const findings = document.getElementById('keyFindings');
    findings.innerHTML = data.summary_bullets.map(b => `<li>${b}</li>`).join('');

    // Recommendations
    const recs = document.getElementById('recommendations');
    recs.innerHTML = data.top_recommendations.map(r => `
      <div class="recommendation priority-${r.priority}">
        <div class="rec-title">${r.title}</div>
        <div class="rec-meta">
          <span>Impact: ${r.impact}</span>
          <span>Effort: ${r.effort}</span>
          <span>Time: ${r.estimated_time}</span>
        </div>
        <div class="rec-action">${r.action}</div>
      </div>
    `).join('');

    // Financial
    document.getElementById('riskExposure').textContent = '$' + formatNumber(data.financial_impact.total_exposure);
    document.getElementById('investmentNeeded').textContent = '$' + formatNumber(data.financial_impact.investment_required);
    document.getElementById('expectedROI').textContent = data.roi_analysis.roi_percentage + '%';
    document.getElementById('paybackPeriod').textContent = data.roi_analysis.payback_period_months 
      ? data.roi_analysis.payback_period_months + ' months'
      : 'N/A';

  } catch (error) {
    console.error('Error loading dashboard:', error);
  }
}

function formatNumber(num) {
  if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
  if (num >= 1000) return (num / 1000).toFixed(0) + 'K';
  return num.toString();
}

async function exportReport() {
  const token = localStorage.getItem('token');
  window.location.href = '/api/executive/export/csv?token=' + token;
}

loadExecutiveDashboard();
</script>
</body>
</html>
